<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Host - Card Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #game-state {
            margin-top: 20px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Host - Card Game</h1>
    <p>Your Host ID: <span id="host-id"></span></p>
    <button id="start-game">Start Game</button>
    <div id="game-state"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.3.1/dist/peerjs.min.js"></script>
    <script>
        const peer = new Peer();  // Create a PeerJS instance for the host
        let players = [];
        let gameState = {
            players: [],
            deck: [],
            turn: 0,
            winner: null,
        };

        // Generate a shuffled deck of cards
        function initializeDeck() {
            const suits = ['Hearts', 'Diamonds', 'Clubs', 'Spades'];
            const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'Jack', 'Queen', 'King', 'Ace'];
            gameState.deck = suits.flatMap(suit => values.map(value => `${value} of ${suit}`));
            gameState.deck.sort(() => Math.random() - 0.5);  // Shuffle deck
        }

        // Broadcast the updated game state to all players
        function broadcastGameState() {
            players.forEach(conn => conn.send({ type: 'updateState', state: gameState }));
            document.getElementById('game-state').textContent = JSON.stringify(gameState, null, 2);
        }

        // Handle new player connections
        peer.on('connection', conn => {
            console.log('Player connected:', conn.peer);
            players.push(conn);

            // Add player to the game state
            gameState.players.push({ id: conn.peer, hand: [] });

            conn.on('data', data => {
                if (data.type === 'playCard') {
                    // Handle card play
                    const player = gameState.players.find(p => p.id === conn.peer);
                    const playedCard = player.hand.splice(data.cardIndex, 1)[0];
                    console.log(`${conn.peer} played ${playedCard}`);

                    // Move to next turn
                    gameState.turn = (gameState.turn + 1) % gameState.players.length;
                    broadcastGameState();
                }
            });
        });

        // Initialize the game and deal cards
        document.getElementById('start-game').addEventListener('click', () => {
            initializeDeck();
            gameState.players.forEach(player => {
                player.hand = gameState.deck.splice(0, 5);  // Deal 5 cards to each player
            });
            broadcastGameState();
        });

        // When the host's peer ID is ready, display it
        peer.on('open', id => {
            document.getElementById('host-id').textContent = id;
        });
    </script>
</body>
</html>
